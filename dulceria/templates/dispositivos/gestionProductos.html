{% extends "accounts/base.html" %}
{% block content %}
<style>
.card {
  border-radius: 16px !important;
}
input, select {
  border-radius: 8px !important;
}
.table th, .table td {
  vertical-align: middle;
}
</style>
<div class="card mb-4 shadow-sm border-0">
  <div class="card-body">
    <h5 class="card-title mb-3 fw-bold">
      {% if edit_mode %}Editar producto{% else %}Nuevo producto{% endif %}
    </h5>
    <form method="post" autocomplete="off">
      {% csrf_token %}
      {% if edit_mode %}
        <input type="hidden" name="edit_id" value="{{ edit_id }}">
      {% endif %}
      
      <ul class="nav nav-tabs mb-3" id="productTab" role="tablist">
        <li class="nav-item">
          <button class="nav-link active" id="tab-id-precios" data-bs-toggle="tab"
            data-bs-target="#id-precios" type="button" role="tab">
            1. Identificación y precios
          </button>
        </li>
        <li class="nav-item">
          <button class="nav-link" id="tab-stock" data-bs-toggle="tab"
            data-bs-target="#stock-control" type="button" role="tab">
            2. Stock y control
          </button>
        </li>
      </ul>
      
      <div class="tab-content" id="productTabContent">
        <!-- Tab 1: Identificación y precios -->
        <div class="tab-pane fade show active" id="id-precios" role="tabpanel">
          <div class="row mb-3">
            <div class="col-md-3">
              <label class="form-label">SKU</label>
              <input type="text" class="form-control" name="sku" value="{{ form.sku.value|default_if_none:'' }}" required />
            </div>
            <div class="col-md-6">
              <label class="form-label">Nombre</label>
              <input type="text" class="form-control" name="nombre" value="{{ form.nombre.value|default_if_none:'' }}" required />
            </div>
            <div class="col-md-3">
              <label class="form-label">Categoría</label>
              <input type="text" class="form-control" name="categoria" value="{{ form.categoria.value|default_if_none:'' }}" />
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-2">
              <label class="form-label">Unidad compra</label>
              <input type="text" class="form-control" name="uom_compra" value="{{ form.uom_compra.value|default_if_none:'' }}" />
            </div>
            <div class="col-md-2">
              <label class="form-label">Unidad venta</label>
              <input type="text" class="form-control" name="uom_venta" value="{{ form.uom_venta.value|default_if_none:'' }}" />
            </div>
            <div class="col-md-2">
              <label class="form-label">Conversión</label>
              <input type="number" class="form-control" name="factor_conversion" value="{{ form.factor_conversion.value|default_if_none:1 }}" />
            </div>
            <div class="col-md-2">
              <label class="form-label">IVA (%)</label>
              <input type="number" class="form-control" name="impuesto_iva" value="{{ form.impuesto_iva.value|default_if_none:0 }}" />
            </div>
          </div>
        </div>
        
        <!-- Tab 2: Stock y control -->
        <div class="tab-pane fade" id="stock-control" role="tabpanel">
          <div class="row mb-3">
            <div class="col-md-3">
              <label class="form-label">Stock mínimo</label>
              <input type="number" class="form-control" name="stock_minimo" value="{{ form.stock_minimo.value|default_if_none:0 }}" />
            </div>
            <div class="col-md-3 form-check form-switch mt-4">
              <input class="form-check-input" type="checkbox" name="perishable" id="perishableSwitch" 
                {% if form.perishable.value %}checked{% endif %} value="1">
              <label class="form-check-label" for="perishableSwitch">Perecible</label>
            </div>
            <div class="col-md-3 form-check form-switch mt-4">
              <input class="form-check-input" type="checkbox" name="lote" id="controlLoteSwitch" 
                {% if form.lote.value %}checked{% endif %} value="1">
              <label class="form-check-label" for="controlLoteSwitch">Control por lote</label>
            </div>
          </div>
        </div>
      </div>
      
      <div class="d-flex justify-content-end mt-4">
        <button type="submit" class="btn btn-primary me-2">
          {% if edit_mode %}Actualizar{% else %}Guardar{% endif %}
        </button>
        {% if edit_mode %}
          <a href="{% url 'Productos' %}" class="btn btn-outline-secondary">Cancelar</a>
        {% else %}
          <button type="reset" class="btn btn-outline-secondary">Limpiar</button>
        {% endif %}
      </div>
    </form>
  </div>
</div>

<!-- Tabla de Productos -->
<div class="card shadow-sm border-0">
  <div class="card-body">
    <h5 class="card-title fw-bold">Productos</h5>
    <div class="d-flex mb-2">
      <input class="form-control me-2" type="text" placeholder="Buscar por SKU o nombre..." style="max-width:250px;">
      <button class="btn btn-outline-primary">Exportar a Excel</button>
    </div>
    <div class="table-responsive">
      <table class="table table-bordered table-hover rounded">
        <thead class="table-light">
          <tr class="text-center">
            <th>SKU</th>
            <th>Nombre</th>
            <th>Categoría</th>
            <th>Stock mínimo</th>
            <th>IVA (%)</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for producto in productos %}
          <tr>
            <td>{{ producto.sku }}</td>
            <td>{{ producto.nombre }}</td>
            <td>{{ producto.categoria }}</td>
            <td>{{ producto.stock_minimo }}</td>
            <td>{{ producto.impuesto_iva }}%</td>
            <td class="text-center">
              <a href="?edit_id={{ producto.pk }}" class="btn btn-sm btn-outline-secondary mb-1" title="Editar">
                <i class="bi bi-pencil-square"></i>
              </a>
              <a href="?delete_id={{ producto.pk }}" class="btn btn-sm btn-outline-danger mb-1" title="Eliminar"
                 onclick="return confirm('¿Seguro que deseas eliminar este producto?')">
                <i class="bi bi-trash"></i>
              </a>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="text-center text-muted">Sin productos registrados.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
