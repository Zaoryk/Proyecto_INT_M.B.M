{% extends "accounts/base.html" %}
{% block content %}
<h1 class="mb-4 fw-bold">Dashboard — Dulcería Lilis</h1>
<p>Bienvenido/a, <strong>{{ user.username }}</strong>. Visitas: <span class="badge bg-info">{{ visitas }}</span></p>

<!-- Tarjetas con datos reales -->
<div class="row g-4 mb-3">
  <div class="col-md-3">
    <div class="card shadow-sm border-primary h-100">
      <div class="card-body text-center">
        <i class="bi bi-person-circle display-4 text-primary"></i>
        <h6 class="fw-bold mt-2">Usuarios</h6>
        <div class="h4">{{ usuarios_count }}</div>
        <div class="progress" style="height:6px;">
          <div class="progress-bar bg-primary" style="width: {% widthratio usuarios_count 100 100 %}%"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow-sm border-success h-100">
      <div class="card-body text-center">
        <i class="bi bi-box-fill display-4 text-success"></i>
        <h6 class="fw-bold mt-2">Productos</h6>
        <div class="h4">{{ productos_count }}</div>
        <div class="progress" style="height:6px;">
          <div class="progress-bar bg-success" style="width: {% widthratio productos_count 100 100 %}%"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow-sm border-warning h-100">
      <div class="card-body text-center">
        <i class="bi bi-building display-4 text-warning"></i>
        <h6 class="fw-bold mt-2">Proveedores</h6>
        <div class="h4">{{ proveedores_count }}</div>
        <div class="progress" style="height:6px;">
          <div class="progress-bar bg-warning" style="width: {% widthratio proveedores_count 50 100 %}%"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow-sm border-info h-100">
      <div class="card-body text-center">
        <i class="bi bi-bar-chart-fill display-4 text-info"></i>
        <h6 class="fw-bold mt-2">Movimientos</h6>
        <div class="h4">{{ movimientos_count }}</div>
        <div class="progress" style="height:6px;">
          <div class="progress-bar bg-info" style="width: {% widthratio movimientos_count 100 100 %}%"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Timeline y Actividad -->
<div class="row g-4">
  <div class="col-md-6">
    <div class="card shadow-sm h-100">
      <div class="card-header bg-white fw-bold">
        <i class="bi bi-clock-history me-1"></i> Timeline
      </div>
      <div class="card-body">
        <ul class="list-group list-group-flush">
          {% for movimiento in ultimos_movimientos %}
            <li class="list-group-item">
              <span class="badge text-bg-primary me-2">{{ movimiento.fecha|date:"H:i" }}</span>
              Movimiento: {{ movimiento.tipo }} - {{ movimiento.producto.nombre }} ({{ movimiento.cantidad }})
            </li>
          {% empty %}
            <li class="list-group-item text-muted">Sin movimientos recientes.</li>
          {% endfor %}
          {% for usuario in ultimos_usuarios %}
            <li class="list-group-item">
              <span class="badge text-bg-success me-2">Reciente</span>
              Nuevo usuario: {{ usuario.username }}
            </li>
          {% empty %}
            <li class="list-group-item text-muted">Sin usuarios recientes.</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card shadow-sm h-100">
      <div class="card-header bg-white fw-bold">
        <i class="bi bi-bar-chart-line-fill me-1"></i> Actividad
      </div>
      <div class="card-body">
        <div class="mb-2">Resumen de registros</div>
        <div class="d-flex align-items-end mb-3">
          <div class="me-1">
            <div class="bg-primary rounded" style="height:{{ usuarios_count|default:10 }}px;width:18px;"></div>
            <small class="d-block text-center">U</small>
          </div>
          <div class="me-1">
            <div class="bg-success rounded" style="height:{{ productos_count|default:10 }}px;width:18px;"></div>
            <small class="d-block text-center">P</small>
          </div>
          <div class="me-1">
            <div class="bg-warning rounded" style="height:{{ proveedores_count|default:10 }}px;width:18px;"></div>
            <small class="d-block text-center">Pr</small>
          </div>
          <div class="me-1">
            <div class="bg-info rounded" style="height:{{ movimientos_count|default:10 }}px;width:18px;"></div>
            <small class="d-block text-center">M</small>
          </div>
        </div>
        <small class="text-muted">Usuarios(U), Productos(P), Proveedores(Pr), Movimientos(M)</small>
      </div>
    </div>
  </div>
</div>

<!-- Accesos rápidos -->
<div class="row g-4 mt-3">
  <div class="col-md-3">
    <a href="{% url 'Formulario' %}" class="card text-center text-decoration-none border-primary border-2 shadow-sm h-100 card-hover">
      <div class="card-body">
        <i class="bi bi-person-vcard display-6 text-primary"></i>
        <h5 class="fw-bold">Usuarios</h5>
        <p class="small text-muted">Gestión de usuarios</p>
      </div>
    </a>
  </div>
  <div class="col-md-3">
    <a href="{% url 'Productos' %}" class="card text-center text-decoration-none border-success border-2 shadow-sm h-100 card-hover">
      <div class="card-body">
        <i class="bi bi-box-seam display-6 text-success"></i>
        <h5 class="fw-bold">Productos</h5>
        <p class="small text-muted">Inventario</p>
      </div>
    </a>
  </div>
  <div class="col-md-3">
    <a href="{% url 'Proveedores' %}" class="card text-center text-decoration-none border-warning border-2 shadow-sm h-100 card-hover">
      <div class="card-body">
        <i class="bi bi-building-fill-gear display-6 text-warning"></i>
        <h5 class="fw-bold">Proveedores</h5>
        <p class="small text-muted">Relaciones comerciales</p>
      </div>
    </a>
  </div>
  <div class="col-md-3">
    <a href="{% url 'Transaccional' %}" class="card text-center text-decoration-none border-info border-2 shadow-sm h-100 card-hover">
      <div class="card-body">
        <i class="bi bi-ui-checks display-6 text-info"></i>
        <h5 class="fw-bold">Inventario</h5>
        <p class="small text-muted">Movimientos</p>
      </div>
    </a>
  </div>
</div>
{% endblock %}
